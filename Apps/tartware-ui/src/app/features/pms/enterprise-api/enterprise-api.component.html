<section class="module-page">
  <div class="module-page__header">
    <div>
      <p class="eyebrow">Enterprise Module</p>
      <h1>Enterprise & API</h1>
      <p class="subtitle">
        {{
          moduleDefinition()?.description
            || 'Harden integrations, observability, and automation flows for large-scale operations.'
        }}
      </p>
    </div>
    <div class="header-actions">
      <button mat-stroked-button color="primary">
        <mat-icon>key</mat-icon>
        Rotate Keys
      </button>
      <button mat-stroked-button>
        <mat-icon>terminal</mat-icon>
        Generate Client
      </button>
    </div>
  </div>

  <mat-progress-bar *ngIf="isLoading()" mode="indeterminate"></mat-progress-bar>

  <mat-card *ngIf="definitionError()" class="error-banner">
    <mat-icon>warning</mat-icon>
    <span>{{ definitionError() }}</span>
  </mat-card>

  <mat-card *ngIf="dataError()" class="error-banner">
    <mat-icon>warning</mat-icon>
    <span>{{ dataError() }}</span>
  </mat-card>

  <div class="module-page__grid">
    <mat-card class="module-summary" *ngIf="moduleDefinition() as module">
      <div class="module-summary__tier">
        <span class="chip">{{ module.tier | titlecase }} tier</span>
        <span class="chip chip--muted">{{ module.category }}</span>
      </div>

      <h2>{{ module.name }}</h2>
      <p>{{ module.description }}</p>

      <mat-divider></mat-divider>

      <div class="module-features">
        <h3>Capabilities</h3>
        <ul>
          <li *ngFor="let feature of module.features">
            <mat-icon>check_circle</mat-icon>
            <span>{{ feature }}</span>
          </li>
        </ul>
      </div>
    </mat-card>

    <mat-card class="metrics-card">
      <div class="card-header">
        <div>
          <p class="eyebrow">API Health</p>
          <h3>Usage across {{ tenantLabel() }}</h3>
        </div>
        <button mat-button>
          <mat-icon>insights</mat-icon>
          Observability
        </button>
      </div>

      <div class="metrics-grid">
        <div class="metric" *ngFor="let metric of apiUsage()">
          <p class="metric__label">{{ metric.label }}</p>
          <p class="metric__value">{{ metric.value }}</p>
          <p
            class="metric__helper"
            [class.metric__helper--down]="metric.direction === 'down'"
          >
            <mat-icon>
              {{ metric.direction === 'down' ? 'south' : 'north' }}
            </mat-icon>
            {{ metric.trend }}
          </p>
        </div>
      </div>
    </mat-card>
  </div>

  <div class="module-page__grid module-page__grid--two">
    <mat-card>
      <div class="card-header">
        <div>
          <p class="eyebrow">Integrations</p>
          <h3>Runtime status</h3>
        </div>
        <button mat-button>
          <mat-icon>sync</mat-icon>
          Refresh
        </button>
      </div>

      <table mat-table [dataSource]="integrationStatuses()" class="integration-table">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Integration</th>
          <td mat-cell *matCellDef="let row">
            <div class="integration-name">
              <mat-icon>hub</mat-icon>
              <div>
                <p>{{ row.name }}</p>
                <span>{{ row.type }}</span>
              </div>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef>Type</th>
          <td mat-cell *matCellDef="let row">{{ row.type }}</td>
        </ng-container>

        <ng-container matColumnDef="latency">
          <th mat-header-cell *matHeaderCellDef>Latency</th>
          <td mat-cell *matCellDef="let row">{{ row.latency }}</td>
        </ng-container>

        <ng-container matColumnDef="lastSync">
          <th mat-header-cell *matHeaderCellDef>Last sync</th>
          <td mat-cell *matCellDef="let row">{{ row.lastSync }}</td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let row">
            <span class="status-chip" [class.status-chip--warning]="row.status === 'warning'">
              {{ row.status === 'warning' ? 'Degraded' : 'Healthy' }}
            </span>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="integrationColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: integrationColumns"></tr>
      </table>
    </mat-card>

    <mat-card>
      <div class="card-header">
        <div>
          <p class="eyebrow">Security log</p>
          <h3>Recent events</h3>
        </div>
        <button mat-button>
          <mat-icon>rule</mat-icon>
          Audit settings
        </button>
      </div>

      <mat-list>
        <mat-list-item *ngFor="let event of securityLog()">
          <div matListItemTitle>{{ event.title }}</div>
          <div matListItemLine>{{ event.timestamp }}</div>
          <div matListItemLine class="security-action">{{ event.action }}</div>
          <span
            matListItemMeta
            class="status-chip"
            [class.status-chip--warning]="event.severity === 'warning'"
          >
            {{ event.severity | titlecase }}
          </span>
        </mat-list-item>
      </mat-list>
    </mat-card>
  </div>
</section>
