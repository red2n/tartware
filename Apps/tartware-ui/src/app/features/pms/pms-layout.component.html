<mat-sidenav-container class="pms-container">
  <!-- Sidebar -->
  <mat-sidenav
    #sidenav
    [mode]="isMobile() ? 'over' : 'side'"
    [opened]="isMobile() ? sidebarOpen() : true"
    class="pms-sidebar"
    [class.compact]="sidebarCompact()"
    [style.width.px]="drawerWidth()"
    [style.minWidth.px]="drawerWidth()"
    [style.maxWidth.px]="drawerWidth()"
    [disableClose]="!isMobile()"
  >
    <!-- Sidebar Header -->
    <div class="sidebar-header">
      <div class="logo-section">
        <div class="logo-icon">
          <mat-icon>business</mat-icon>
        </div>
        @if (!sidebarCompact()) {
          <div class="logo-text">
            <h3>Tartware PMS</h3>
            <p>{{ tenantName() }}</p>
          </div>
        }
      </div>
    </div>

    <!-- Navigation Menu -->
    <mat-nav-list class="nav-list">
      @for (item of visibleMenuItems(); track item.id) {
        <a
          mat-list-item
          [routerLink]="['/pms', activeTenant()?.id, item.route]"
          routerLinkActive="active"
          [routerLinkActiveOptions]="{ exact: item.id === 'dashboard' }"
          class="nav-item"
          [matTooltip]="sidebarCompact() ? item.label : ''"
          matTooltipPosition="right"
          [matTooltipDisabled]="!sidebarCompact()"
        >
          <mat-icon matListItemIcon [matBadge]="item.badge || undefined" matBadgeColor="warn">
            {{ item.icon }}
          </mat-icon>
          @if (!sidebarCompact()) {
            <span matListItemTitle>{{ item.label }}</span>
          }
        </a>
      }
    </mat-nav-list>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer" [class.compact]="sidebarCompact()">
      <button
        mat-stroked-button
        (click)="switchTenant()"
        class="switch-tenant-btn"
      >
        <mat-icon>swap_horiz</mat-icon>
        @if (!sidebarCompact()) {
          <span>Switch Tenant</span>
        }
      </button>
    </div>
  </mat-sidenav>

  <!-- Main Content -->
  <mat-sidenav-content
    class="pms-content"
    [class.compact]="sidebarCompact()"
    [style.marginLeft.px]="!isMobile() ? drawerWidth() : 0"
  >
    <!-- Top Bar -->
    <mat-toolbar class="top-bar">
      <!-- Left section -->
      <div class="top-bar-left">
        <button
          mat-icon-button
          (click)="toggleSidebar()"
          [attr.aria-label]="sidebarToggleLabel()"
          [matTooltip]="sidebarToggleTooltip()"
          class="sidebar-toggle-btn"
        >
          <mat-icon>{{ sidebarToggleIcon() }}</mat-icon>
        </button>

        <div class="breadcrumb">
          <mat-icon>apartment</mat-icon>
          <span class="tenant-name">{{ tenantName() }}</span>
        </div>

        <!-- Property Selector (for multi-property tenants) -->
        @if (hasMultipleProperties()) {
          <div class="property-selector">
            <mat-icon>domain</mat-icon>
            <mat-select [value]="selectedPropertyId()" (selectionChange)="switchProperty($event.value)" class="property-select">
              @for (property of properties(); track property.id) {
                <mat-option [value]="property.id">
                  <mat-icon>apartment</mat-icon>
                  <span>{{ property.name }}</span>
                </mat-option>
              }
            </mat-select>
          </div>
        }
      </div>

      <!-- Right section -->
      <div class="top-bar-right">
        <!-- Theme toggle -->
        <button
          mat-icon-button
          (click)="toggleTheme()"
          [attr.aria-label]="(themeService.isDark() ? 'Switch to light' : 'Switch to dark') + ' theme'"
          matTooltip="{{ themeService.isDark() ? 'Light mode' : 'Dark mode' }}"
        >
          <mat-icon>{{ themeService.isDark() ? 'light_mode' : 'dark_mode' }}</mat-icon>
        </button>

        <!-- Notifications -->
        <button mat-icon-button matTooltip="Notifications" [matBadge]="5" matBadgeColor="warn">
          <mat-icon>notifications</mat-icon>
        </button>

        <!-- User menu -->
        <button
          mat-icon-button
          [matMenuTriggerFor]="userMenu"
          matTooltip="User menu"
        >
          <mat-icon>account_circle</mat-icon>
        </button>

        <mat-menu #userMenu="matMenu">
          <div class="user-menu-header">
            <mat-icon>account_circle</mat-icon>
            <div>
              <p class="user-name">{{ userName() }}</p>
              <p class="user-email">{{ authContext()?.email }}</p>
            </div>
          </div>
          <mat-divider></mat-divider>
          <button mat-menu-item>
            <mat-icon>person</mat-icon>
            <span>Profile</span>
          </button>
          <button mat-menu-item>
            <mat-icon>settings</mat-icon>
            <span>Settings</span>
          </button>
          <mat-divider></mat-divider>
        </mat-menu>

        <button
          mat-stroked-button
          class="logout-btn"
          (click)="logout()"
          matTooltip="Logout"
        >
          <mat-icon>logout</mat-icon>
          <span>Logout</span>
        </button>
      </div>
    </mat-toolbar>

    <!-- Page Content -->
    <div class="page-content">
      <router-outlet></router-outlet>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
