/**
 * Material Design 3 (M3) Theme Configuration
 * Reference: https://m3.material.io/
 */

@use '@angular/material' as mat;

// Include M3 core styles
@include mat.core();

// Define M3 Primary Palette (Indigo)
$tartware-primary: mat.m2-define-palette(mat.$m2-indigo-palette, 500);
$tartware-accent: mat.m2-define-palette(mat.$m2-blue-palette, 600);
$tartware-warn: mat.m2-define-palette(mat.$m2-red-palette, 500);

// Create Light Theme (M3)
$tartware-light-theme: mat.m2-define-light-theme((
  color: (
    primary: $tartware-primary,
    accent: $tartware-accent,
    warn: $tartware-warn,
  ),
  typography: mat.m2-define-typography-config(
    $font-family: 'Roboto, "Helvetica Neue", sans-serif',
  ),
  density: 0,
));

// Apply M3 theme to all components
@include mat.all-component-themes($tartware-light-theme);

// Create Dark Theme (M3)
$tartware-dark-theme: mat.m2-define-dark-theme((
  color: (
    primary: $tartware-primary,
    accent: $tartware-accent,
    warn: $tartware-warn,
  ),
));

// Dark theme class (GitHub Soft Dark inspired)
.dark-theme {
  @include mat.all-component-colors($tartware-dark-theme);

  // GitHub Soft Dark palette
  // Reference: https://github.com/settings/appearance
  --background: #0d1117;           // Canvas background
  --surface: #161b22;              // Elevated surfaces (cards, panels)
  --surface-overlay: #21262d;      // Hover/overlay state
  --border: #30363d;               // Border color
  --border-muted: #21262d;         // Subtle borders

  --text-primary: #c9d1d9;         // Primary text
  --text-secondary: #8b949e;       // Secondary text
  --text-tertiary: #6e7681;        // Tertiary/disabled text
  --text-link: #58a6ff;            // Links

  --accent-blue: #58a6ff;          // Primary actions
  --accent-blue-hover: #388bfd;    // Hover state
  --success-green: #3fb950;        // Success state
  --danger-red: #f85149;           // Error/danger state
  --warning-yellow: #d29922;       // Warning state
  --attention-orange: #db6d28;     // Attention/info state

  // Dark theme elevation shadows (softer)
  --md-sys-elevation-0: none;
  --md-sys-elevation-1: 0 0 0 1px var(--border-muted), 0 1px 3px rgba(0, 0, 0, 0.4);
  --md-sys-elevation-2: 0 0 0 1px var(--border-muted), 0 3px 6px rgba(0, 0, 0, 0.4);
  --md-sys-elevation-3: 0 0 0 1px var(--border), 0 8px 16px rgba(0, 0, 0, 0.4);
  --md-sys-elevation-4: 0 0 0 1px var(--border), 0 12px 24px rgba(0, 0, 0, 0.4);
  --md-sys-elevation-5: 0 0 0 1px var(--border), 0 16px 32px rgba(0, 0, 0, 0.4);

  // Apply dark theme to document
  background-color: var(--background);
  color: var(--text-primary);

  // Material component overrides for dark theme
  .mat-mdc-card {
    background-color: var(--surface);
    color: var(--text-primary);
    border: 1px solid var(--border);
    box-shadow: var(--md-sys-elevation-1);
  }

  .mat-mdc-form-field {
    .mat-mdc-text-field-wrapper {
      background-color: var(--background);

      .mat-mdc-form-field-flex {
        background-color: var(--background);
      }
    }

    .mat-mdc-input-element {
      color: var(--text-primary);
      caret-color: var(--accent-blue);
    }

    .mat-mdc-form-field-label {
      color: var(--text-secondary);
    }

    &.mat-focused {
      .mat-mdc-form-field-label {
        color: var(--accent-blue);
      }
    }
  }

  .mat-mdc-button, .mat-mdc-raised-button, .mat-mdc-flat-button {
    &.mat-primary {
      --mdc-text-button-label-text-color: var(--accent-blue);
      --mdc-protected-button-container-color: var(--accent-blue);
      --mdc-protected-button-label-text-color: #ffffff;
    }

    &.mat-accent {
      --mdc-text-button-label-text-color: var(--success-green);
    }

    &.mat-warn {
      --mdc-text-button-label-text-color: var(--danger-red);
    }
  }

  .mat-mdc-table {
    background-color: var(--surface);
    color: var(--text-primary);

    th {
      color: var(--text-primary);
      border-bottom-color: var(--border);
    }

    td {
      color: var(--text-primary);
      border-bottom-color: var(--border-muted);
    }

    tr:hover {
      background-color: var(--surface-overlay);
    }
  }

  // Material progress bar
  .mat-mdc-progress-bar {
    --mdc-linear-progress-active-indicator-color: var(--accent-blue);
    --mdc-linear-progress-track-color: var(--border);
  }

  // Links
  a {
    color: var(--text-link);

    &:hover {
      color: var(--accent-blue-hover);
    }
  }

  // Scrollbar (WebKit browsers)
  ::-webkit-scrollbar {
    width: 10px;
    height: 10px;
  }

  ::-webkit-scrollbar-track {
    background: var(--background);
  }

  ::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 5px;

    &:hover {
      background: var(--text-tertiary);
    }
  }
}

// M3 Design Tokens
:root {
  // Surface colors (light theme)
  --md-sys-color-surface: #fef7ff;
  --md-sys-color-surface-variant: #e7e0ec;
  --md-sys-color-on-surface: #1d1b20;
  --md-sys-color-on-surface-variant: #49454f;
  --md-sys-color-surface-container-lowest: #ffffff;
  --md-sys-color-surface-container-low: #f7f2fa;
  --md-sys-color-surface-container: #f3edf7;
  --md-sys-color-surface-container-high: #ece6f0;
  --md-sys-color-surface-container-highest: #e6e0e9;

  // Primary colors
  --md-sys-color-primary: #6750a4;
  --md-sys-color-on-primary: #ffffff;
  --md-sys-color-primary-container: #eaddff;
  --md-sys-color-on-primary-container: #21005d;

  // Secondary colors
  --md-sys-color-secondary: #625b71;
  --md-sys-color-on-secondary: #ffffff;
  --md-sys-color-secondary-container: #e8def8;
  --md-sys-color-on-secondary-container: #1d192b;

  // Tertiary colors
  --md-sys-color-tertiary: #7d5260;
  --md-sys-color-on-tertiary: #ffffff;
  --md-sys-color-tertiary-container: #ffd8e4;
  --md-sys-color-on-tertiary-container: #31111d;

  // Error colors
  --md-sys-color-error: #b3261e;
  --md-sys-color-on-error: #ffffff;
  --md-sys-color-error-container: #f9dedc;
  --md-sys-color-on-error-container: #410e0b;

  // Elevation shadows
  --md-sys-elevation-0: none;
  --md-sys-elevation-1: 0 1px 2px rgba(0, 0, 0, 0.3), 0 1px 3px 1px rgba(0, 0, 0, 0.15);
  --md-sys-elevation-2: 0 1px 2px rgba(0, 0, 0, 0.3), 0 2px 6px 2px rgba(0, 0, 0, 0.15);
  --md-sys-elevation-3: 0 4px 8px 3px rgba(0, 0, 0, 0.15), 0 1px 3px rgba(0, 0, 0, 0.3);
  --md-sys-elevation-4: 0 6px 10px 4px rgba(0, 0, 0, 0.15), 0 2px 3px rgba(0, 0, 0, 0.3);
  --md-sys-elevation-5: 0 8px 12px 6px rgba(0, 0, 0, 0.15), 0 4px 4px rgba(0, 0, 0, 0.3);

  // Shape (corner radius)
  --md-sys-shape-corner-none: 0;
  --md-sys-shape-corner-extra-small: 4px;
  --md-sys-shape-corner-small: 8px;
  --md-sys-shape-corner-medium: 12px;
  --md-sys-shape-corner-large: 16px;
  --md-sys-shape-corner-extra-large: 28px;
  --md-sys-shape-corner-full: 50%;
}

// M3 Component Customizations
.mat-mdc-card {
  border-radius: var(--md-sys-shape-corner-medium);
  box-shadow: var(--md-sys-elevation-1);

  &.elevated {
    box-shadow: var(--md-sys-elevation-2);
  }
}

.mat-mdc-button, .mat-mdc-raised-button, .mat-mdc-flat-button {
  border-radius: var(--md-sys-shape-corner-extra-large);
  min-width: 48px;
  min-height: 48px;
}

.mat-mdc-form-field {
  &.mat-form-field-appearance-outline {
    .mat-mdc-text-field-wrapper {
      border-radius: var(--md-sys-shape-corner-extra-small);
    }
  }
}

// Accessibility: Respect motion preferences
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    transition-duration: 0.01ms !important;
  }
}

// Accessibility: High contrast mode support
@media (prefers-contrast: high) {
  .mat-mdc-button, .mat-mdc-raised-button {
    border: 2px solid currentColor;
  }
}
