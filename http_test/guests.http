###############################################################################
# GUESTS SERVICE - Guest Profiles & Management
# Routes via API Gateway (localhost:8080) -> guests-service (port 3300)
#
# Content: Guest Profile Queries (READ OPERATIONS)
#
# WRITE OPERATIONS: All guest write operations go through the
# Command Center. See command-center.http for:
#   - guest.register
#   - guest.merge
#   - guest.update_profile
#   - guest.update_contact
#   - guest.set_loyalty
#   - guest.set_vip
#   - guest.set_blacklist
#   - guest.gdpr.erase
#   - guest.preference.update
#
# Related files:
# - command-center.http - Write operations (commands)
# - reservations.http - Guest reservations
# - billing.http - Guest billing
###############################################################################

# --- VARIABLES ---
@baseUrl = http://localhost:8080
@tenantId = 11111111-1111-1111-1111-111111111111
@propertyId = 22222222-2222-2222-2222-222222222222

###############################################################################
# 1. LOGIN
###############################################################################

# @name login
POST {{baseUrl}}/v1/auth/login
Content-Type: application/json

{
  "username": "setup.admin",
  "password": "TempPass123"
}

### Extract token
@authToken = {{login.response.body.access_token}}

###############################################################################
# 2. GUESTS - LIST WITH FILTERS
###############################################################################

# List all guests for tenant
GET {{baseUrl}}/v1/guests?tenant_id={{tenantId}}&limit=50
Authorization: Bearer {{authToken}}

###
# List guests for specific property
GET {{baseUrl}}/v1/guests?tenant_id={{tenantId}}&property_id={{propertyId}}&limit=50
Authorization: Bearer {{authToken}}

###
# Filter by email (partial match)
GET {{baseUrl}}/v1/guests?tenant_id={{tenantId}}&email=john
Authorization: Bearer {{authToken}}

###
# Filter by phone
GET {{baseUrl}}/v1/guests?tenant_id={{tenantId}}&phone=555-0101
Authorization: Bearer {{authToken}}

###
# Filter by VIP status
GET {{baseUrl}}/v1/guests?tenant_id={{tenantId}}&vip_status=true
Authorization: Bearer {{authToken}}

###
# Filter by loyalty tier
GET {{baseUrl}}/v1/guests?tenant_id={{tenantId}}&loyalty_tier=GOLD
Authorization: Bearer {{authToken}}

###
# Filter blacklisted guests
GET {{baseUrl}}/v1/guests?tenant_id={{tenantId}}&is_blacklisted=true
Authorization: Bearer {{authToken}}

###
# Combine multiple filters - VIP guests with PLATINUM loyalty
GET {{baseUrl}}/v1/guests?tenant_id={{tenantId}}&vip_status=true&loyalty_tier=PLATINUM
Authorization: Bearer {{authToken}}

###############################################################################
# 3. GUEST PREFERENCES - LIST BY GUEST
###############################################################################

@guestId = 33333333-3333-3333-3333-333333333333

###
# List all preferences for a guest
GET {{baseUrl}}/v1/guests/{{guestId}}/preferences?tenant_id={{tenantId}}
Authorization: Bearer {{authToken}}

###
# Filter by category - ROOM preferences
GET {{baseUrl}}/v1/guests/{{guestId}}/preferences?tenant_id={{tenantId}}&category=room
Authorization: Bearer {{authToken}}

###
# Filter by category - SERVICE preferences
GET {{baseUrl}}/v1/guests/{{guestId}}/preferences?tenant_id={{tenantId}}&category=service
Authorization: Bearer {{authToken}}

###
# Filter by category - DIETARY preferences
GET {{baseUrl}}/v1/guests/{{guestId}}/preferences?tenant_id={{tenantId}}&category=dietary
Authorization: Bearer {{authToken}}

###
# Filter by category - ACCESSIBILITY preferences
GET {{baseUrl}}/v1/guests/{{guestId}}/preferences?tenant_id={{tenantId}}&category=accessibility
Authorization: Bearer {{authToken}}

###
# Filter by category - COMMUNICATION preferences
GET {{baseUrl}}/v1/guests/{{guestId}}/preferences?tenant_id={{tenantId}}&category=communication
Authorization: Bearer {{authToken}}

###
# Active preferences only
GET {{baseUrl}}/v1/guests/{{guestId}}/preferences?tenant_id={{tenantId}}&active_only=true
Authorization: Bearer {{authToken}}

###############################################################################
# 4. GUEST DOCUMENTS - LIST BY GUEST
###############################################################################

###
# List all documents for a guest
GET {{baseUrl}}/v1/guests/{{guestId}}/documents?tenant_id={{tenantId}}
Authorization: Bearer {{authToken}}

###
# Filter by document type - PASSPORT
GET {{baseUrl}}/v1/guests/{{guestId}}/documents?tenant_id={{tenantId}}&document_type=passport
Authorization: Bearer {{authToken}}

###
# Filter by document type - NATIONAL_ID
GET {{baseUrl}}/v1/guests/{{guestId}}/documents?tenant_id={{tenantId}}&document_type=national_id
Authorization: Bearer {{authToken}}

###
# Filter by document type - DRIVERS_LICENSE
GET {{baseUrl}}/v1/guests/{{guestId}}/documents?tenant_id={{tenantId}}&document_type=drivers_license
Authorization: Bearer {{authToken}}

###
# Filter by verification status - VERIFIED
GET {{baseUrl}}/v1/guests/{{guestId}}/documents?tenant_id={{tenantId}}&verification_status=verified
Authorization: Bearer {{authToken}}

###
# Filter by verification status - PENDING
GET {{baseUrl}}/v1/guests/{{guestId}}/documents?tenant_id={{tenantId}}&verification_status=pending
Authorization: Bearer {{authToken}}

###
# Filter by verification status - EXPIRED
GET {{baseUrl}}/v1/guests/{{guestId}}/documents?tenant_id={{tenantId}}&verification_status=expired
Authorization: Bearer {{authToken}}

###############################################################################
# 5. GUEST COMMUNICATIONS - LIST BY GUEST
###############################################################################

###
# List all communications for a guest
GET {{baseUrl}}/v1/guests/{{guestId}}/communications?tenant_id={{tenantId}}
Authorization: Bearer {{authToken}}

###
# Filter by communication type - EMAIL
GET {{baseUrl}}/v1/guests/{{guestId}}/communications?tenant_id={{tenantId}}&communication_type=email
Authorization: Bearer {{authToken}}

###
# Filter by communication type - SMS
GET {{baseUrl}}/v1/guests/{{guestId}}/communications?tenant_id={{tenantId}}&communication_type=sms
Authorization: Bearer {{authToken}}

###
# Filter by communication type - PHONE
GET {{baseUrl}}/v1/guests/{{guestId}}/communications?tenant_id={{tenantId}}&communication_type=phone
Authorization: Bearer {{authToken}}

###
# Filter by direction - OUTBOUND (sent to guest)
GET {{baseUrl}}/v1/guests/{{guestId}}/communications?tenant_id={{tenantId}}&direction=outbound
Authorization: Bearer {{authToken}}

###
# Filter by direction - INBOUND (from guest)
GET {{baseUrl}}/v1/guests/{{guestId}}/communications?tenant_id={{tenantId}}&direction=inbound
Authorization: Bearer {{authToken}}

###
# Filter by status - DELIVERED
GET {{baseUrl}}/v1/guests/{{guestId}}/communications?tenant_id={{tenantId}}&status=delivered
Authorization: Bearer {{authToken}}

###
# Filter by status - OPENED
GET {{baseUrl}}/v1/guests/{{guestId}}/communications?tenant_id={{tenantId}}&status=opened
Authorization: Bearer {{authToken}}

###
# Filter by status - FAILED
GET {{baseUrl}}/v1/guests/{{guestId}}/communications?tenant_id={{tenantId}}&status=failed
Authorization: Bearer {{authToken}}

###############################################################################
# 6. REST-STYLE COMMAND DISPATCH
# Alternative to /v1/commands/{name}/execute pattern
# These routes dispatch commands via the gateway
###############################################################################

###############################################################################
# 6A. REST-STYLE GUEST CREATION (POST /v1/guests)
# Forwards to guest.register command via Command Center
###############################################################################

###
# Register a new guest (REST shortcut)
POST {{baseUrl}}/v1/guests
Content-Type: application/json
Authorization: Bearer {{authToken}}
X-Request-ID: {{$guid}}
X-Idempotency-Key: guest-reg-{{$timestamp}}

{
  "tenant_id": "{{tenantId}}",
  "property_id": "{{propertyId}}",
  "first_name": "Alice",
  "last_name": "Johnson",
  "email": "alice.johnson@example.com",
  "phone": "+1-555-0201",
  "date_of_birth": "1990-04-22",
  "nationality": "US",
  "language": "en",
  "id_type": "PASSPORT",
  "id_number": "P1234567"
}

###############################################################################
# 6B. REST-STYLE GUEST MERGE (POST /v1/guests/merge)
# Merges duplicate guest profiles via Command Center
###############################################################################

###
# Merge duplicate guest profiles (REST shortcut)
POST {{baseUrl}}/v1/guests/merge
Content-Type: application/json
Authorization: Bearer {{authToken}}
X-Request-ID: {{$guid}}
X-Idempotency-Key: guest-merge-{{$timestamp}}

{
  "tenant_id": "{{tenantId}}",
  "primary_guest_id": "{{guestId}}",
  "duplicate_guest_id": "eeeeeeee-eeee-eeee-eeee-eeeeeeeeeeee",
  "merge_preferences": true,
  "merge_documents": true,
  "merge_communications": true,
  "notes": "Duplicate detected during check-in"
}

###############################################################################
# 6C. REST-STYLE PROFILE UPDATES
###############################################################################

###
# Update guest profile
POST {{baseUrl}}/v1/tenants/{{tenantId}}/guests/{{guestId}}/profile
Content-Type: application/json
Authorization: Bearer {{authToken}}
X-Request-ID: {{$guid}}
X-Idempotency-Key: profile-{{$timestamp}}

{
  "first_name": "Jane",
  "last_name": "Doe-Smith",
  "date_of_birth": "1985-06-15",
  "anniversary_date": "2020-09-15",
  "company": "Acme Corp",
  "job_title": "Director of Operations"
}

###
# Update guest contact info
POST {{baseUrl}}/v1/tenants/{{tenantId}}/guests/{{guestId}}/contact
Content-Type: application/json
Authorization: Bearer {{authToken}}
X-Request-ID: {{$guid}}
X-Idempotency-Key: contact-{{$timestamp}}

{
  "email": "jane.smith@newcompany.com",
  "phone": "+1-555-0303",
  "mobile": "+1-555-0304",
  "address": {
    "line1": "456 Park Avenue",
    "city": "New York",
    "state": "NY",
    "postal_code": "10022",
    "country": "US"
  }
}

###
# Update guest loyalty status
POST {{baseUrl}}/v1/tenants/{{tenantId}}/guests/{{guestId}}/loyalty
Content-Type: application/json
Authorization: Bearer {{authToken}}
X-Request-ID: {{$guid}}
X-Idempotency-Key: loyalty-{{$timestamp}}

{
  "loyalty_program": "TARTWARE_REWARDS",
  "membership_number": "TR-2026-001234",
  "tier": "GOLD",
  "points_balance": 15000,
  "tier_expiry_date": "2027-12-31",
  "enrollment_date": "2024-01-15"
}

###
# Update VIP status
POST {{baseUrl}}/v1/tenants/{{tenantId}}/guests/{{guestId}}/vip
Content-Type: application/json
Authorization: Bearer {{authToken}}
X-Request-ID: {{$guid}}
X-Idempotency-Key: vip-{{$timestamp}}

{
  "vip_status": true,
  "vip_level": "PLATINUM",
  "vip_reason": "Top 100 lifetime revenue guest",
  "special_amenities": ["WELCOME_CHAMPAGNE", "SUITE_UPGRADE", "LATE_CHECKOUT"],
  "notes": "Personal greeting by GM required"
}

###
# Update blacklist status
POST {{baseUrl}}/v1/tenants/{{tenantId}}/guests/{{guestId}}/blacklist
Content-Type: application/json
Authorization: Bearer {{authToken}}
X-Request-ID: {{$guid}}
X-Idempotency-Key: blacklist-{{$timestamp}}

{
  "blacklisted": true,
  "reason": "Credit card fraud - incident #INC-2026-001",
  "severity": "HIGH",
  "effective_date": "2026-02-01",
  "expiry_date": null,
  "incident_reference": "INC-2026-001"
}

###
# GDPR erase (Right to be Forgotten)
POST {{baseUrl}}/v1/tenants/{{tenantId}}/guests/{{guestId}}/gdpr-erase
Content-Type: application/json
Authorization: Bearer {{authToken}}
X-Request-ID: {{$guid}}
X-Idempotency-Key: gdpr-{{$timestamp}}

{
  "request_reference": "GDPR-2026-001",
  "verification_method": "EMAIL_CONFIRMATION",
  "verification_date": "2026-02-01",
  "retain_financial_records": true,
  "retention_period_years": 7,
  "notes": "Guest requested data erasure via email"
}

###
# Update guest preferences
POST {{baseUrl}}/v1/tenants/{{tenantId}}/guests/{{guestId}}/preferences
Content-Type: application/json
Authorization: Bearer {{authToken}}
X-Request-ID: {{$guid}}
X-Idempotency-Key: pref-{{$timestamp}}

{
  "preferences": {
    "room_type": "SUITE",
    "bed_type": "KING",
    "floor_preference": "HIGH",
    "smoking": false,
    "pillow_type": "FIRM",
    "room_temperature": 21,
    "newspaper": "Financial Times",
    "dietary_restrictions": ["VEGETARIAN", "GLUTEN_FREE"],
    "allergies": ["NUTS"],
    "minibar_preferences": ["NO_ALCOHOL"],
    "communication_preference": "EMAIL",
    "language": "en"
  }
}

###############################################################################
# REFERENCE
###############################################################################
#
# ID TYPES:
#   PASSPORT, DRIVERS_LICENSE, NATIONAL_ID, VISA, OTHER
#
# VIP LEVELS:
#   STANDARD, SILVER, GOLD, PLATINUM, DIAMOND
#
# LOYALTY TIERS:
#   BRONZE, SILVER, GOLD, PLATINUM, DIAMOND
#
# PREFERENCE CATEGORIES:
#   ROOM, SERVICE, DIETARY, ACCESSIBILITY, COMMUNICATION, BILLING,
#   AMENITY, EXPERIENCE, OTHER
#
# DOCUMENT TYPES:
#   passport, national_id, drivers_license, visa, work_permit,
#   registration_card, invoice, receipt, agreement, contract,
#   photo, signature, credit_card, insurance, other
#
# VERIFICATION STATUSES:
#   pending, verified, rejected, expired, requires_update
#
# COMMUNICATION TYPES:
#   EMAIL, SMS, PHONE, WHATSAPP, IN_PERSON, CHAT
#
# COMMUNICATION DIRECTIONS:
#   INBOUND, OUTBOUND
#
# COMMUNICATION STATUSES:
#   DRAFT, QUEUED, SENT, DELIVERED, FAILED, BOUNCED, OPENED, CLICKED
#
# WRITE OPERATIONS:
#   All guest write operations go through the Command Center.
#   See command-center.http for full examples of:
#     POST /v1/commands/guest.register/execute
#     POST /v1/commands/guest.merge/execute
#     POST /v1/commands/guest.update_profile/execute
#     POST /v1/commands/guest.update_contact/execute
#     POST /v1/commands/guest.set_loyalty/execute
#     POST /v1/commands/guest.set_vip/execute
#     POST /v1/commands/guest.set_blacklist/execute
#     POST /v1/commands/guest.gdpr.erase/execute
#     POST /v1/commands/guest.preference.update/execute
#
# REST-STYLE COMMAND DISPATCH (alternative pattern):
#   POST /v1/tenants/:tenantId/guests/:guestId/profile
#   POST /v1/tenants/:tenantId/guests/:guestId/contact
#   POST /v1/tenants/:tenantId/guests/:guestId/loyalty
#   POST /v1/tenants/:tenantId/guests/:guestId/vip
#   POST /v1/tenants/:tenantId/guests/:guestId/blacklist
#   POST /v1/tenants/:tenantId/guests/:guestId/gdpr-erase
#   POST /v1/tenants/:tenantId/guests/:guestId/preferences
#
# SAMPLE IDs:
#   Tenant:   11111111-1111-1111-1111-111111111111
#   Property: 22222222-2222-2222-2222-222222222222
#   Guest:    33333333-3333-3333-3333-333333333333
#
###############################################################################
