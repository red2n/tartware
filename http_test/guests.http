###############################################################################
# GUESTS SERVICE - Guest Profiles & Management
# Routes via API Gateway (localhost:8080) -> guests-service (port 3300)
#
# Content: Guest Registration, Profile Updates, Preferences, VIP/Blacklist
#
# Related files:
# - reservations.http - Guest reservations
# - billing.http - Guest billing
###############################################################################

# --- VARIABLES ---
@baseUrl = http://localhost:8080
@tenantId = 11111111-1111-1111-1111-111111111111

###############################################################################
# 1. LOGIN
###############################################################################

# @name login
POST {{baseUrl}}/v1/auth/login
Content-Type: application/json

{
  "username": "setup.admin",
  "password": "TempPass123"
}

### Extract token
@authToken = {{login.response.body.access_token}}

###############################################################################
# 2. GUESTS - READ
###############################################################################

# List all guests for tenant
GET {{baseUrl}}/v1/guests?tenant_id={{tenantId}}&limit=50
Authorization: Bearer {{authToken}}

###
# Search guests by name
GET {{baseUrl}}/v1/guests?tenant_id={{tenantId}}&search=John
Authorization: Bearer {{authToken}}

###
# Filter by VIP status
GET {{baseUrl}}/v1/guests?tenant_id={{tenantId}}&vip_status=true
Authorization: Bearer {{authToken}}

###
# Get guest by ID
GET {{baseUrl}}/v1/guests/{{guestId}}?tenant_id={{tenantId}}
Authorization: Bearer {{authToken}}

###############################################################################
# 3. GUESTS - CREATE (via Command Center)
###############################################################################

# @name registerGuest
# Register a new guest
POST {{baseUrl}}/v1/guests
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "first_name": "John",
  "last_name": "Smith",
  "email": "john.smith@example.com",
  "phone": "+1-555-0101",
  "address": {
    "line1": "123 Main Street",
    "line2": "Apt 4B",
    "city": "New York",
    "state": "NY",
    "postal_code": "10001",
    "country": "US"
  },
  "date_of_birth": "1985-06-15",
  "nationality": "US",
  "id_type": "PASSPORT",
  "id_number": "AB1234567",
  "id_expiry": "2030-06-15",
  "preferred_language": "en",
  "preferences": {
    "room_type": "high_floor",
    "bed_type": "king",
    "pillow_type": "firm",
    "newspaper": "WSJ",
    "dietary": []
  },
  "marketing_consent": true,
  "vip_status": false,
  "metadata": {}
}

### Extract created guest ID
@guestId = {{registerGuest.response.body.guest_id}}

###
# Register business guest
POST {{baseUrl}}/v1/guests
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "first_name": "Sarah",
  "last_name": "Johnson",
  "email": "sarah.johnson@acme-corp.com",
  "phone": "+1-555-0202",
  "company_name": "ACME Corporation",
  "company_address": {
    "line1": "456 Business Ave",
    "city": "Chicago",
    "state": "IL",
    "postal_code": "60601",
    "country": "US"
  },
  "date_of_birth": "1990-03-22",
  "nationality": "US",
  "id_type": "DRIVERS_LICENSE",
  "id_number": "IL-DL-789456",
  "corporate_code": "ACME2026",
  "preferred_language": "en",
  "preferences": {
    "room_type": "quiet",
    "early_checkin": true,
    "late_checkout": true
  },
  "marketing_consent": false,
  "vip_status": false,
  "metadata": {
    "corporate_account": true,
    "travel_manager": "admin@acme-corp.com"
  }
}

###############################################################################
# 4. GUEST PROFILE UPDATES (via Command Center)
###############################################################################

# Update guest profile
POST {{baseUrl}}/v1/tenants/{{tenantId}}/guests/{{guestId}}/profile
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "first_name": "Jonathan",
  "last_name": "Smith",
  "date_of_birth": "1985-06-15",
  "nationality": "US"
}

###
# Update guest contact information
POST {{baseUrl}}/v1/tenants/{{tenantId}}/guests/{{guestId}}/contact
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "email": "jonathan.smith@newemail.com",
  "phone": "+1-555-0199",
  "address": {
    "line1": "789 New Address",
    "city": "Los Angeles",
    "state": "CA",
    "postal_code": "90001",
    "country": "US"
  }
}

###
# Update guest preferences
POST {{baseUrl}}/v1/tenants/{{tenantId}}/guests/{{guestId}}/preferences
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "preferences": {
    "room_type": "high_floor",
    "bed_type": "king",
    "pillow_type": "soft",
    "minibar_stocked": true,
    "newspaper": "NYT",
    "wake_up_call": "07:00",
    "dietary": ["vegetarian"],
    "allergies": ["peanuts"],
    "smoking": false
  }
}

###############################################################################
# 5. VIP & LOYALTY MANAGEMENT
###############################################################################

# Set VIP status
POST {{baseUrl}}/v1/tenants/{{tenantId}}/guests/{{guestId}}/vip
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "vip_status": true,
  "vip_level": "GOLD",
  "reason": "Frequent guest - 10+ stays"
}

###
# Set loyalty information
POST {{baseUrl}}/v1/tenants/{{tenantId}}/guests/{{guestId}}/loyalty
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "loyalty_program": "TARTWARE_REWARDS",
  "loyalty_number": "TR-2026-001234",
  "loyalty_tier": "GOLD",
  "points_balance": 15000
}

###############################################################################
# 6. BLACKLIST MANAGEMENT
###############################################################################

# Add guest to blacklist
POST {{baseUrl}}/v1/tenants/{{tenantId}}/guests/{{guestId}}/blacklist
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "blacklist_status": true,
  "reason": "Repeated policy violations",
  "notes": "Property damage incidents on 2025-11-15 and 2025-12-20"
}

###
# Remove from blacklist
POST {{baseUrl}}/v1/tenants/{{tenantId}}/guests/{{guestId}}/blacklist
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "blacklist_status": false,
  "reason": "Reinstated after management review",
  "notes": "Agreed to updated terms"
}

###############################################################################
# 7. GUEST MERGE & GDPR
###############################################################################

# Merge duplicate guest profiles
POST {{baseUrl}}/v1/guests/merge
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "primary_guest_id": "{{guestId}}",
  "duplicate_guest_id": "{{duplicateGuestId}}",
  "merge_reason": "Same person, duplicate registration"
}

###
# GDPR - Erase guest data
POST {{baseUrl}}/v1/tenants/{{tenantId}}/guests/{{guestId}}/gdpr-erase
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "reason": "Customer data erasure request",
  "ticket_id": "GDPR-2026-001",
  "verified_identity": true
}

###############################################################################
# REFERENCE
###############################################################################
#
# ID TYPES:
#   PASSPORT, DRIVERS_LICENSE, NATIONAL_ID, VISA, OTHER
#
# VIP LEVELS:
#   STANDARD, SILVER, GOLD, PLATINUM, DIAMOND
#
# LOYALTY TIERS:
#   BRONZE, SILVER, GOLD, PLATINUM, DIAMOND
#
# PREFERENCES:
#   room_type: high_floor, low_floor, quiet, accessible, connecting
#   bed_type: king, queen, twin, double
#   pillow_type: soft, medium, firm, hypoallergenic
#   dietary: vegetarian, vegan, gluten_free, halal, kosher
#
# SAMPLE IDs:
#   Tenant: 11111111-1111-1111-1111-111111111111
#
###############################################################################
