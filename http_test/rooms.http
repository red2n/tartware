###############################################################################
# ROOMS SERVICE - Rooms & Room Types
# Routes via API Gateway (localhost:8080) -> rooms-service (port 3400)
#
# Content: Room Types, Rooms, Room Status/Features
#
# Related files:
# - rates.http - Rate plans and pricing
# - housekeeping.http - Housekeeping tasks
###############################################################################

# --- VARIABLES ---
@baseUrl = http://localhost:8080
@tenantId = 11111111-1111-1111-1111-111111111111
@propertyId = 22222222-2222-2222-2222-222222222222
@roomTypeId = 44444444-4444-4444-4444-444444444444
@room101Id = 55555555-5555-5555-5555-555555555551
@room102Id = 55555555-5555-5555-5555-555555555552

###############################################################################
# 1. LOGIN
###############################################################################

# @name login
POST {{baseUrl}}/v1/auth/login
Content-Type: application/json

{
  "username": "setup.admin",
  "password": "TempPass123"
}

### Extract token
@authToken = {{login.response.body.access_token}}

###############################################################################
# 2. ROOM TYPES - READ
###############################################################################

# List all room types for property
GET {{baseUrl}}/v1/room-types?tenant_id={{tenantId}}&property_id={{propertyId}}
Authorization: Bearer {{authToken}}

###
# Get room type by ID
GET {{baseUrl}}/v1/room-types/{{roomTypeId}}?tenant_id={{tenantId}}
Authorization: Bearer {{authToken}}

###############################################################################
# 3. ROOM TYPES - CREATE
###############################################################################

# @name createRoomType
# Create a new room type - Standard Room
POST {{baseUrl}}/v1/room-types
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "property_id": "{{propertyId}}",
  "type_name": "Standard Room",
  "type_code": "STD",
  "category": "STANDARD",
  "base_occupancy": 2,
  "max_occupancy": 3,
  "max_adults": 2,
  "max_children": 1,
  "extra_bed_capacity": 1,
  "number_of_beds": 1,
  "base_price": 99.00,
  "currency": "USD",
  "amenities": ["WIFI", "TV", "AC", "MINI_BAR"],
  "features": {
    "view": "garden",
    "smoking": false
  },
  "images": [],
  "description": "Comfortable standard room with modern amenities",
  "is_active": true,
  "display_order": 1,
  "metadata": {}
}

### Extract created room type ID
@newRoomTypeId = {{createRoomType.response.body.room_type_id}}

###
# Create Deluxe Suite
POST {{baseUrl}}/v1/room-types
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "property_id": "{{propertyId}}",
  "type_name": "Deluxe Suite",
  "type_code": "DLX",
  "category": "SUITE",
  "base_occupancy": 2,
  "max_occupancy": 4,
  "max_adults": 2,
  "max_children": 2,
  "extra_bed_capacity": 2,
  "number_of_beds": 1,
  "base_price": 199.00,
  "currency": "USD",
  "amenities": ["WIFI", "TV", "AC", "MINI_BAR", "JACUZZI", "BALCONY"],
  "features": {
    "view": "city",
    "smoking": false,
    "size_sqm": 45
  },
  "images": [],
  "description": "Spacious deluxe suite with city views",
  "is_active": true,
  "display_order": 2,
  "metadata": {}
}

###############################################################################
# 4. ROOM TYPES - UPDATE
###############################################################################

# Update room type details
PUT {{baseUrl}}/v1/room-types/{{roomTypeId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "type_name": "Cityline King Room",
  "base_price": 219.00,
  "amenities": ["WIFI", "SMART_TV", "WORK_DESK", "RAIN_SHOWER", "COFFEE_MAKER"]
}

###
# Partial update via PATCH
PATCH {{baseUrl}}/v1/room-types/{{roomTypeId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "is_active": true,
  "display_order": 1
}

###############################################################################
# 5. ROOMS - READ
###############################################################################

# List all rooms for tenant
GET {{baseUrl}}/v1/rooms?tenant_id={{tenantId}}&limit=50
Authorization: Bearer {{authToken}}

###
# List rooms for specific property
GET {{baseUrl}}/v1/rooms?tenant_id={{tenantId}}&property_id={{propertyId}}&limit=50
Authorization: Bearer {{authToken}}

###
# Filter rooms by status
GET {{baseUrl}}/v1/rooms?tenant_id={{tenantId}}&status=available
Authorization: Bearer {{authToken}}

###
# Filter rooms by housekeeping status
GET {{baseUrl}}/v1/rooms?tenant_id={{tenantId}}&housekeeping_status=clean
Authorization: Bearer {{authToken}}

###
# Get room by ID
GET {{baseUrl}}/v1/rooms/{{room101Id}}?tenant_id={{tenantId}}
Authorization: Bearer {{authToken}}

###############################################################################
# 6. ROOMS - CREATE
###############################################################################

# @name createRoom
# Create a new room
POST {{baseUrl}}/v1/rooms
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "property_id": "{{propertyId}}",
  "room_type_id": "{{roomTypeId}}",
  "room_number": "301",
  "floor": "3",
  "features": {
    "view": "pool",
    "balcony": true,
    "smoking": false
  },
  "status": "available",
  "housekeeping_status": "clean",
  "maintenance_status": "operational",
  "is_blocked": false,
  "is_out_of_order": false
}

### Extract created room ID
@newRoomId = {{createRoom.response.body.room_id}}

###############################################################################
# 7. ROOMS - UPDATE
###############################################################################

# Update room details
PUT {{baseUrl}}/v1/rooms/{{room101Id}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "features": {
    "view": "city",
    "balcony": true,
    "smoking": false,
    "accessible": false
  }
}

###############################################################################
# 8. ROOM STATUS COMMANDS (via Command Center)
###############################################################################

# Update room status
POST {{baseUrl}}/v1/tenants/{{tenantId}}/rooms/{{room101Id}}/status
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "status": "occupied"
}

###
# Update housekeeping status
POST {{baseUrl}}/v1/tenants/{{tenantId}}/rooms/{{room101Id}}/housekeeping-status
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "housekeeping_status": "dirty"
}

###
# Mark room out of order
POST {{baseUrl}}/v1/tenants/{{tenantId}}/rooms/{{room101Id}}/out-of-order
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "reason": "Plumbing issue - sink leak",
  "estimated_return": "2026-02-01"
}

###
# Mark room out of service (temporary maintenance)
POST {{baseUrl}}/v1/tenants/{{tenantId}}/rooms/{{room101Id}}/out-of-service
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "reason": "Deep cleaning scheduled",
  "estimated_return": "2026-01-31"
}

###
# Block room inventory
POST {{baseUrl}}/v1/tenants/{{tenantId}}/rooms/{{room101Id}}/block
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "reason": "VIP reservation hold",
  "block_start": "2026-02-01",
  "block_end": "2026-02-05"
}

###
# Release room block
POST {{baseUrl}}/v1/tenants/{{tenantId}}/rooms/{{room101Id}}/release
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "reason": "Block no longer needed"
}

###
# Update room features
POST {{baseUrl}}/v1/tenants/{{tenantId}}/rooms/{{room101Id}}/features
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "features": {
    "view": "city",
    "balcony": true,
    "smoking": false,
    "accessible": true,
    "connecting_room": "102"
  }
}

###############################################################################
# REFERENCE
###############################################################################
#
# ROOM STATUSES:
#   available, occupied, checkout, vacant_dirty, vacant_clean,
#   out_of_order, out_of_service, blocked
#
# HOUSEKEEPING STATUSES:
#   clean, dirty, inspected, in_progress
#
# MAINTENANCE STATUSES:
#   operational, needs_repair, under_repair
#
# ROOM CATEGORIES:
#   STANDARD, SUPERIOR, DELUXE, SUITE, PENTHOUSE, VILLA
#
# SAMPLE IDs:
#   Tenant:    11111111-1111-1111-1111-111111111111
#   Property:  22222222-2222-2222-2222-222222222222
#   Room Type: 44444444-4444-4444-4444-444444444444 (Cityline King)
#   Room 101:  55555555-5555-5555-5555-555555555551
#   Room 102:  55555555-5555-5555-5555-555555555552
#   Room 201:  55555555-5555-5555-5555-555555555553
#   Room 202:  55555555-5555-5555-5555-555555555554
#
###############################################################################
