###############################################################################
# ROOMS SERVICE - Rooms & Room Types
# Routes via API Gateway (localhost:8080) -> rooms-service (port 3400)
#
# Content: Room Types, Rooms (CRUD + STATUS COMMANDS)
#
# WRITE OPERATIONS - Room Status via Command Center:
# See command-center.http for:
#   - rooms.room.update_status
#   - rooms.room.update_housekeeping
#   - rooms.room.block
#   - rooms.room.release
#   - rooms.room.out_of_order
#   - rooms.room.return_to_service
#   - rooms.room.update_features
#   - rooms.room_type.update_inventory
#
# Related files:
# - command-center.http - Status commands
# - rates.http - Rate plans and pricing
# - housekeeping.http - Housekeeping tasks
###############################################################################

# --- VARIABLES ---
@baseUrl = http://localhost:8080
@tenantId = 11111111-1111-1111-1111-111111111111
@propertyId = 22222222-2222-2222-2222-222222222222
@guestId = 33333333-3333-3333-3333-333333333333
@roomTypeId = 44444444-4444-4444-4444-444444444444
@room101Id = 55555555-5555-5555-5555-555555555551
@room102Id = 55555555-5555-5555-5555-555555555552

###############################################################################
# 1. LOGIN
###############################################################################

# @name login
POST {{baseUrl}}/v1/auth/login
Content-Type: application/json

{
  "username": "setup.admin",
  "password": "TempPass123"
}

### Extract token
@authToken = {{login.response.body.access_token}}

###############################################################################
# 2. ROOM TYPES - READ
###############################################################################

# List all room types for property
GET {{baseUrl}}/v1/room-types?tenant_id={{tenantId}}&property_id={{propertyId}}
Authorization: Bearer {{authToken}}

###
# Get room type by ID
GET {{baseUrl}}/v1/room-types/{{roomTypeId}}?tenant_id={{tenantId}}
Authorization: Bearer {{authToken}}

###############################################################################
# 3. ROOM TYPES - CREATE
###############################################################################

# @name createRoomType
# Create a new room type - Standard Room
POST {{baseUrl}}/v1/room-types
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "property_id": "{{propertyId}}",
  "type_name": "Standard Room",
  "type_code": "STD",
  "category": "STANDARD",
  "base_occupancy": 2,
  "max_occupancy": 3,
  "max_adults": 2,
  "max_children": 1,
  "extra_bed_capacity": 1,
  "number_of_beds": 1,
  "base_price": 99.00,
  "currency": "USD",
  "amenities": ["WIFI", "TV", "AC", "MINI_BAR"],
  "features": {
    "view": "garden",
    "smoking": false
  },
  "images": [],
  "description": "Comfortable standard room with modern amenities",
  "is_active": true,
  "display_order": 1,
  "metadata": {}
}

### Extract created room type ID
@newRoomTypeId = {{createRoomType.response.body.room_type_id}}

###
# Create Deluxe Suite
POST {{baseUrl}}/v1/room-types
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "property_id": "{{propertyId}}",
  "type_name": "Deluxe Suite",
  "type_code": "DLX",
  "category": "SUITE",
  "base_occupancy": 2,
  "max_occupancy": 4,
  "max_adults": 2,
  "max_children": 2,
  "extra_bed_capacity": 2,
  "number_of_beds": 1,
  "base_price": 199.00,
  "currency": "USD",
  "amenities": ["WIFI", "TV", "AC", "MINI_BAR", "JACUZZI", "BALCONY"],
  "features": {
    "view": "city",
    "smoking": false,
    "size_sqm": 45
  },
  "images": [],
  "description": "Spacious deluxe suite with city views",
  "is_active": true,
  "display_order": 2,
  "metadata": {}
}

###############################################################################
# 4. ROOM TYPES - UPDATE
###############################################################################

# Update room type details
PUT {{baseUrl}}/v1/room-types/{{roomTypeId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "type_name": "Cityline King Room",
  "base_price": 219.00,
  "amenities": ["WIFI", "SMART_TV", "WORK_DESK", "RAIN_SHOWER", "COFFEE_MAKER"]
}

###
# Partial update via PATCH
PATCH {{baseUrl}}/v1/room-types/{{roomTypeId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "is_active": true,
  "display_order": 1
}

###############################################################################
# 5. ROOMS - READ
###############################################################################

# List all rooms for tenant
GET {{baseUrl}}/v1/rooms?tenant_id={{tenantId}}&limit=50
Authorization: Bearer {{authToken}}

###
# List rooms for specific property
GET {{baseUrl}}/v1/rooms?tenant_id={{tenantId}}&property_id={{propertyId}}&limit=50
Authorization: Bearer {{authToken}}

###
# Filter rooms by status
GET {{baseUrl}}/v1/rooms?tenant_id={{tenantId}}&status=available
Authorization: Bearer {{authToken}}

###
# Filter rooms by housekeeping status
GET {{baseUrl}}/v1/rooms?tenant_id={{tenantId}}&housekeeping_status=clean
Authorization: Bearer {{authToken}}

###############################################################################
# 5B. ROOMS - READ WITH RECOMMENDATIONS
# When guest context is provided, rooms are ranked by recommendation score
# Requires: recommendation-service running (npm run dev:recommendation)
###############################################################################

### List rooms with personalized recommendations
# Returns rooms sorted by recommendation_rank with recommendation_score and recommendation_reasons
GET {{baseUrl}}/v1/rooms?tenant_id={{tenantId}}&property_id={{propertyId}}&check_in_date=2025-02-10&check_out_date=2025-02-12&adults=2&children=0&limit=50
Authorization: Bearer {{authToken}}

###
# Rooms with guest context for better personalization
GET {{baseUrl}}/v1/rooms?tenant_id={{tenantId}}&property_id={{propertyId}}&guest_id={{guestId}}&check_in_date=2025-03-15&check_out_date=2025-03-18&adults=2&children=1&limit=50
Authorization: Bearer {{authToken}}

###
# Combined filters with recommendations
GET {{baseUrl}}/v1/rooms?tenant_id={{tenantId}}&property_id={{propertyId}}&status=available&check_in_date=2025-04-01&check_out_date=2025-04-05&adults=1&children=0&limit=50
Authorization: Bearer {{authToken}}

###############################################################################

###
# Get room by ID
GET {{baseUrl}}/v1/rooms/{{room101Id}}?tenant_id={{tenantId}}
Authorization: Bearer {{authToken}}

###
# Get room by ID with recommendation scoring
# Returns recommendation_rank, recommendation_score, recommendation_reasons
GET {{baseUrl}}/v1/rooms/{{room101Id}}?tenant_id={{tenantId}}&check_in_date=2025-02-10&check_out_date=2025-02-12&adults=2&children=0
Authorization: Bearer {{authToken}}

###
# Get room by ID with guest context for personalized scoring
GET {{baseUrl}}/v1/rooms/{{room102Id}}?tenant_id={{tenantId}}&guest_id={{guestId}}&check_in_date=2025-03-15&check_out_date=2025-03-18&adults=2&children=1
Authorization: Bearer {{authToken}}

###############################################################################
# 6. ROOMS - CREATE
###############################################################################

# @name createRoom
# Create a new room
POST {{baseUrl}}/v1/rooms
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "property_id": "{{propertyId}}",
  "room_type_id": "{{roomTypeId}}",
  "room_number": "301",
  "floor": "3",
  "features": {
    "view": "pool",
    "balcony": true,
    "smoking": false
  },
  "status": "available",
  "housekeeping_status": "clean",
  "maintenance_status": "operational",
  "is_blocked": false,
  "is_out_of_order": false
}

### Extract created room ID
@newRoomId = {{createRoom.response.body.room_id}}

###############################################################################
# 7. ROOMS - UPDATE
###############################################################################

# Update room details
PUT {{baseUrl}}/v1/rooms/{{room101Id}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "features": {
    "view": "city",
    "balcony": true,
    "smoking": false,
    "accessible": false
  }
}

###############################################################################
# 8. ROOMS - DELETE
###############################################################################

# Delete a room (soft delete)
DELETE {{baseUrl}}/v1/rooms/{{newRoomId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}"
}

###############################################################################
# 9. ROOM TYPES - DELETE
###############################################################################

# Delete a room type (soft delete)
DELETE {{baseUrl}}/v1/room-types/{{newRoomTypeId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}"
}

###############################################################################
# 10. ROOM STATUS COMMANDS (via Command Center)
# These endpoints represent the desired behavior.
# Implementation via Command Center - see command-center.http
###############################################################################

#
# NOTE: Room status updates go through the Command Center for event sourcing.
# See command-center.http for full command examples.
#
# Command patterns:
#   POST /v1/commands/rooms.room.update_status/execute
#   POST /v1/commands/rooms.room.update_housekeeping/execute
#   POST /v1/commands/rooms.room.block/execute
#   POST /v1/commands/rooms.room.release/execute
#   POST /v1/commands/rooms.room.out_of_order/execute
#   POST /v1/commands/rooms.room.return_to_service/execute
#   POST /v1/commands/rooms.room.update_features/execute
#

###############################################################################
# REFERENCE
###############################################################################
#
# ROOM STATUSES:
#   available, occupied, checkout, vacant_dirty, vacant_clean,
#   out_of_order, out_of_service, blocked
#
# HOUSEKEEPING STATUSES:
#   clean, dirty, inspected, in_progress
#
# MAINTENANCE STATUSES:
#   operational, needs_repair, under_repair
#
# ROOM CATEGORIES:
#   STANDARD, SUPERIOR, DELUXE, SUITE, PENTHOUSE, VILLA
#
# COMMAND CENTER OPERATIONS:
#   All room status updates go through the Command Center.
#   See command-center.http for full examples of:
#     POST /v1/commands/rooms.room.update_status/execute
#     POST /v1/commands/rooms.room.update_housekeeping/execute
#     POST /v1/commands/rooms.room.block/execute
#     POST /v1/commands/rooms.room.release/execute
#     POST /v1/commands/rooms.room.out_of_order/execute
#     POST /v1/commands/rooms.room.return_to_service/execute
#     POST /v1/commands/rooms.room.update_features/execute
#     POST /v1/commands/rooms.room_type.update_inventory/execute
#
# SAMPLE IDs:
#   Tenant:    11111111-1111-1111-1111-111111111111
#   Property:  22222222-2222-2222-2222-222222222222
#   Room Type: 44444444-4444-4444-4444-444444444444 (Cityline King)
#   Room 101:  55555555-5555-5555-5555-555555555551
#   Room 102:  55555555-5555-5555-5555-555555555552
#   Room 201:  55555555-5555-5555-5555-555555555553
#   Room 202:  55555555-5555-5555-5555-555555555554
#
###############################################################################
