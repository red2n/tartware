###############################################################################
# RATES SERVICE - Rate Plans & Pricing
# Routes via API Gateway (localhost:8080) -> rooms-service (port 3015)
#
# Content: Rate Plans, Pricing Strategies, Rate Management
#
# Related files:
# - rooms.http - Rooms and room types
# - reservations.http - Using rates for bookings
###############################################################################

# --- VARIABLES ---
@baseUrl = http://localhost:8080
@tenantId = 11111111-1111-1111-1111-111111111111
@propertyId = 22222222-2222-2222-2222-222222222222
@roomTypeId = 44444444-4444-4444-4444-444444444444

###############################################################################
# 1. LOGIN
###############################################################################

# @name login
POST {{baseUrl}}/v1/auth/login
Content-Type: application/json

{
  "username": "setup.admin",
  "password": "TempPass123"
}

### Extract token
@authToken = {{login.response.body.access_token}}

###############################################################################
# 2. RATES - READ
###############################################################################

# List all rates for tenant
GET {{baseUrl}}/v1/rates?tenant_id={{tenantId}}&limit=50
Authorization: Bearer {{authToken}}

###
# List rates for specific property
GET {{baseUrl}}/v1/rates?tenant_id={{tenantId}}&property_id={{propertyId}}
Authorization: Bearer {{authToken}}

###
# List rates for room type
GET {{baseUrl}}/v1/rates?tenant_id={{tenantId}}&room_type_id={{roomTypeId}}
Authorization: Bearer {{authToken}}

###
# Filter by status
GET {{baseUrl}}/v1/rates?tenant_id={{tenantId}}&status=ACTIVE
Authorization: Bearer {{authToken}}

###
# Filter by rate type (BAR, PROMOTIONAL, CORPORATE, etc.)
GET {{baseUrl}}/v1/rates?tenant_id={{tenantId}}&rate_type=BAR
Authorization: Bearer {{authToken}}

###
# Search rates by name/code
GET {{baseUrl}}/v1/rates?tenant_id={{tenantId}}&search=BAR
Authorization: Bearer {{authToken}}

###
# Get rate by ID
GET {{baseUrl}}/v1/rates/{{newRateId}}?tenant_id={{tenantId}}
Authorization: Bearer {{authToken}}

###############################################################################
# 3. RATES - CREATE
###############################################################################

# @name createRate
# Create Best Available Rate (BAR)
POST {{baseUrl}}/v1/rates
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "property_id": "{{propertyId}}",
  "room_type_id": "{{roomTypeId}}",
  "rate_name": "Best Available Rate",
  "rate_code": "BAR2",
  "rate_type": "BAR",
  "strategy": "DYNAMIC",
  "priority": 100,
  "description": "Our best flexible rate with free cancellation",
  "base_rate": 199.00,
  "currency": "USD",
  "single_occupancy_rate": 179.00,
  "double_occupancy_rate": 199.00,
  "extra_person_rate": 25.00,
  "extra_child_rate": 15.00,
  "valid_from": "2026-01-01",
  "valid_until": "2026-12-31",
  "advance_booking_days_min": 0,
  "advance_booking_days_max": 365,
  "min_length_of_stay": 1,
  "max_length_of_stay": 30,
  "closed_to_arrival": false,
  "closed_to_departure": false,
  "meal_plan": "RO",
  "meal_plan_cost": 0,
  "cancellation_policy": {
    "type": "flexible",
    "hours": 24,
    "penalty": 0
  },
  "modifiers": {
    "weekendSurcharge": 20,
    "seasonalModifier": 0,
    "discounts": []
  },
  "channels": ["direct", "ota", "phone"],
  "customer_segments": ["all"],
  "tax_inclusive": false,
  "tax_rate": 12.5,
  "status": "ACTIVE",
  "display_order": 1,
  "metadata": {}
}

### Extract created rate ID
@newRateId = {{createRate.response.body.id}}

###
# Create Advance Purchase Rate
POST {{baseUrl}}/v1/rates
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "property_id": "{{propertyId}}",
  "room_type_id": "{{roomTypeId}}",
  "rate_name": "Advance Purchase",
  "rate_code": "ADV14",
  "rate_type": "PROMOTIONAL",
  "strategy": "FIXED",
  "priority": 90,
  "description": "Book 14+ days in advance and save 15%",
  "base_rate": 169.00,
  "currency": "USD",
  "single_occupancy_rate": 159.00,
  "double_occupancy_rate": 169.00,
  "extra_person_rate": 25.00,
  "valid_from": "2026-01-01",
  "valid_until": "2026-12-31",
  "advance_booking_days_min": 14,
  "advance_booking_days_max": 365,
  "min_length_of_stay": 2,
  "closed_to_arrival": false,
  "closed_to_departure": false,
  "meal_plan": "RO",
  "cancellation_policy": {
    "type": "non_refundable",
    "penalty": 100
  },
  "channels": ["direct", "ota"],
  "customer_segments": ["all"],
  "tax_inclusive": false,
  "tax_rate": 12.5,
  "status": "ACTIVE",
  "display_order": 2,
  "metadata": {}
}

###
# Create Corporate Rate
POST {{baseUrl}}/v1/rates
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "property_id": "{{propertyId}}",
  "room_type_id": "{{roomTypeId}}",
  "rate_name": "Corporate Rate",
  "rate_code": "CORP",
  "rate_type": "CORPORATE",
  "strategy": "FIXED",
  "priority": 80,
  "description": "Special corporate rate for business travelers",
  "base_rate": 159.00,
  "currency": "USD",
  "single_occupancy_rate": 149.00,
  "double_occupancy_rate": 159.00,
  "extra_person_rate": 20.00,
  "valid_from": "2026-01-01",
  "valid_until": "2026-12-31",
  "advance_booking_days_min": 0,
  "min_length_of_stay": 1,
  "closed_to_arrival": false,
  "closed_to_departure": false,
  "meal_plan": "BB",
  "meal_plan_cost": 20.00,
  "cancellation_policy": {
    "type": "flexible",
    "hours": 6,
    "penalty": 0
  },
  "channels": ["direct", "phone"],
  "customer_segments": ["corporate"],
  "tax_inclusive": false,
  "tax_rate": 12.5,
  "status": "ACTIVE",
  "display_order": 3,
  "metadata": {
    "requires_corporate_code": true
  }
}

###
# Create Weekend Package
POST {{baseUrl}}/v1/rates
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "property_id": "{{propertyId}}",
  "room_type_id": "{{roomTypeId}}",
  "rate_name": "Weekend Getaway",
  "rate_code": "WKND",
  "rate_type": "PACKAGE",
  "strategy": "FIXED",
  "priority": 70,
  "description": "2-night weekend package with breakfast",
  "base_rate": 349.00,
  "currency": "USD",
  "double_occupancy_rate": 349.00,
  "extra_person_rate": 30.00,
  "valid_from": "2026-01-01",
  "valid_until": "2026-12-31",
  "advance_booking_days_min": 7,
  "min_length_of_stay": 2,
  "max_length_of_stay": 3,
  "closed_to_arrival": true,
  "closed_to_departure": false,
  "meal_plan": "BB",
  "meal_plan_cost": 0,
  "cancellation_policy": {
    "type": "moderate",
    "hours": 48,
    "penalty": 50
  },
  "channels": ["direct", "ota"],
  "customer_segments": ["leisure"],
  "tax_inclusive": true,
  "tax_rate": 12.5,
  "status": "ACTIVE",
  "display_order": 4,
  "metadata": {
    "arrival_days": ["Friday", "Saturday"],
    "includes_spa_credit": 50
  }
}

###############################################################################
# 4. RATES - UPDATE
###############################################################################

# Get a rate to update (use ID from list)
# First get the rate ID
GET {{baseUrl}}/v1/rates?tenant_id={{tenantId}}&rate_code=BAR&limit=1
Authorization: Bearer {{authToken}}

###
# Update rate pricing
PUT {{baseUrl}}/v1/rates/{{newRateId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}",
  "base_rate": 209.00,
  "single_occupancy_rate": 189.00,
  "double_occupancy_rate": 209.00,
  "modifiers": {
    "weekendSurcharge": 25,
    "seasonalModifier": 10
  }
}

###############################################################################
# 5. RATES - DELETE
###############################################################################

# Soft delete a rate
DELETE {{baseUrl}}/v1/rates/{{newRateId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "tenant_id": "{{tenantId}}"
}

###############################################################################
# REFERENCE
###############################################################################
#
# RATE TYPES:
#   BAR          - Best Available Rate (dynamic)
#   RACK         - Published rate
#   PROMOTIONAL  - Special offers, packages
#   CORPORATE    - Business rates
#   PACKAGE      - Bundled rates with extras
#   GROUP        - Group booking rates
#   NEGOTIATED   - Contract rates
#
# RATE STRATEGIES:
#   FIXED    - Static pricing
#   DYNAMIC  - Yield-managed pricing
#   DERIVED  - Based on another rate
#
# RATE STATUSES:
#   ACTIVE, INACTIVE, DRAFT, ARCHIVED
#
# MEAL PLANS:
#   RO  - Room Only
#   BB  - Bed & Breakfast
#   HB  - Half Board
#   FB  - Full Board
#   AI  - All Inclusive
#
# CANCELLATION TYPES:
#   flexible      - Free cancellation until deadline
#   moderate      - Partial penalty
#   strict        - Higher penalty
#   non_refundable - No refund
#
# SAMPLE IDs:
#   Tenant:    11111111-1111-1111-1111-111111111111
#   Property:  22222222-2222-2222-2222-222222222222
#   Room Type: 44444444-4444-4444-4444-444444444444
#
###############################################################################
