###############################################################################
# Guest Self-Service Endpoints (guest-experience-service)
#
# Guest-facing, public endpoints for:
# - Mobile / self-service check-in (S17)
# - Registration card generation (S27)
# - Mobile key retrieval (S28)
# - Direct booking engine — search, book, lookup (S30)
#
# These endpoints authenticate via confirmation code, NOT JWT.
# Routes are proxied via API Gateway → guest-experience-service (port 3065).
###############################################################################

@baseUrl = http://localhost:8080

# --- Sample IDs (update after creating test data) ---
@tenantId = 11111111-1111-1111-1111-111111111111
@propertyId = 22222222-2222-2222-2222-222222222222
@roomTypeId = 44444444-4444-4444-4444-444444444444
# @reservationId =
# @checkinId =
# @confirmationCode =

###############################################################################
# DIRECT BOOKING ENGINE (S30)
###############################################################################

### Search available room types
# @name searchAvailability
GET {{baseUrl}}/v1/self-service/search?tenant_id={{tenantId}}&property_id={{propertyId}}&check_in_date=2026-03-01&check_out_date=2026-03-03&adults=2&children=0

### Search with children
# @name searchWithChildren
GET {{baseUrl}}/v1/self-service/search?tenant_id={{tenantId}}&property_id={{propertyId}}&check_in_date=2026-03-01&check_out_date=2026-03-05&adults=2&children=1

### Create a direct booking
# @name createBooking
POST {{baseUrl}}/v1/self-service/book
Content-Type: application/json

{
  "tenant_id": "{{tenantId}}",
  "property_id": "{{propertyId}}",
  "guest_email": "john.doe@example.com",
  "guest_first_name": "John",
  "guest_last_name": "Doe",
  "guest_phone": "+1-555-0101",
  "room_type_id": "{{roomTypeId}}",
  "check_in_date": "2026-03-01",
  "check_out_date": "2026-03-03",
  "adults": 2,
  "children": 0,
  "payment_token": "tok_test_visa_4242",
  "special_requests": "Late check-in, high floor preferred",
  "idempotency_key": "booking-test-001"
}

### Look up booking by confirmation code
# @name lookupBooking
GET {{baseUrl}}/v1/self-service/booking/CONF-ABC123

###############################################################################
# MOBILE CHECK-IN (S17)
###############################################################################

### Start mobile check-in
# @name startCheckin
POST {{baseUrl}}/v1/self-service/check-in/start
Content-Type: application/json

{
  "tenant_id": "{{tenantId}}",
  "confirmation_code": "CONF-ABC123",
  "guest_email": "john.doe@example.com"
}

### Complete mobile check-in
# @name completeCheckin
POST {{baseUrl}}/v1/self-service/check-in/{{checkinId}}/complete
Content-Type: application/json

{
  "tenant_id": "{{tenantId}}",
  "identity_verified": true,
  "terms_accepted": true,
  "digital_signature": "data:image/png;base64,iVBORw0KGgoAAAANS..."
}

### Get check-in status
# @name getCheckinStatus
GET {{baseUrl}}/v1/self-service/check-in/{{checkinId}}?tenant_id={{tenantId}}

###############################################################################
# REGISTRATION CARD (S27)
###############################################################################

### Get or generate registration card (JSON)
# @name getRegistrationCard
GET {{baseUrl}}/v1/self-service/registration-card/{{reservationId}}?tenant_id={{tenantId}}

### Get registration card as HTML
# @name getRegistrationCardHtml
GET {{baseUrl}}/v1/self-service/registration-card/{{reservationId}}/html?tenant_id={{tenantId}}

###############################################################################
# MOBILE KEYS (S28)
###############################################################################

### Get active mobile keys for a reservation
# @name getActiveKeys
GET {{baseUrl}}/v1/self-service/keys/{{reservationId}}?tenant_id={{tenantId}}
