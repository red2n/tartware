<h2 mat-dialog-title>New Rate Plan</h2>

<mat-dialog-content>
  @if (error(); as err) {
    <div class="flash flash-error">
      <mat-icon class="flash-icon">error</mat-icon>
      {{ err }}
    </div>
  }

  <div class="form-grid">
    <!-- Row 1: Name + Code -->
    <div class="field-group field-required">
      <label class="field-label" for="rateName">Rate name</label>
      <input class="field-input" id="rateName" type="text"
             placeholder="e.g. Best Available Rate"
             [class.field-error]="validationErrors['rateName']"
             [(ngModel)]="rateName" />
      @if (validationErrors['rateName']; as msg) {
        <span class="field-hint-error">{{ msg }}</span>
      }
    </div>

    <div class="field-group field-required">
      <label class="field-label" for="rateCode">Rate code</label>
      <input class="field-input" id="rateCode" type="text"
             placeholder="e.g. BAR"
             [ngModel]="rateCode"
             (ngModelChange)="onRateCodeInput($event)"
             [class.field-error]="validationErrors['rateCode']"
             maxlength="50"
             style="text-transform: uppercase" />
      @if (validationErrors['rateCode']; as msg) {
        <span class="field-hint-error">{{ msg }}</span>
      }
    </div>

    <!-- Row 2: Type + Strategy -->
    <div class="field-group">
      <label class="field-label" for="rateType">Rate type</label>
      <select class="field-input" id="rateType" [(ngModel)]="rateType">
        @for (t of rateTypes; track t.key) {
          <option [value]="t.key">{{ t.label }}</option>
        }
      </select>
    </div>

    <div class="field-group">
      <label class="field-label" for="strategy">Strategy</label>
      <select class="field-input" id="strategy" [(ngModel)]="strategy">
        @for (s of strategies; track s.key) {
          <option [value]="s.key">{{ s.label }}</option>
        }
      </select>
    </div>

    <!-- Row 3: Base rate + Currency -->
    <div class="field-group field-required">
      <label class="field-label" for="baseRate">Base rate</label>
      <input class="field-input" id="baseRate" type="number"
             min="0" step="0.01"
             placeholder="0.00"
             [class.field-error]="validationErrors['baseRate']"
             [(ngModel)]="baseRate" />
      @if (validationErrors['baseRate']; as msg) {
        <span class="field-hint-error">{{ msg }}</span>
      }
    </div>

    <div class="field-group">
      <label class="field-label">Currency</label>
      <span class="field-value-locked">{{ currency }}</span>
      <span class="text-subtle">Set at property level</span>
    </div>

    <!-- Row 4: SGL + DBL -->
    <div class="field-group">
      <label class="field-label" for="sglRate">Single occupancy</label>
      <input class="field-input" id="sglRate" type="number"
             min="0" step="0.01"
             placeholder="Optional"
             [class.field-error]="validationErrors['sglRate']"
             [(ngModel)]="singleOccupancyRate" />
      @if (validationErrors['sglRate']; as msg) {
        <span class="field-hint-error">{{ msg }}</span>
      }
    </div>

    <div class="field-group">
      <label class="field-label" for="dblRate">Double occupancy</label>
      <input class="field-input" id="dblRate" type="number"
             min="0" step="0.01"
             placeholder="Optional"
             [class.field-error]="validationErrors['dblRate']"
             [(ngModel)]="doubleOccupancyRate" />
      @if (validationErrors['dblRate']; as msg) {
        <span class="field-hint-error">{{ msg }}</span>
      }
    </div>

    <!-- Row 5: Extra person rate + Meal plan -->
    <div class="field-group">
      <label class="field-label" for="extraPerson">Extra person rate</label>
      <input class="field-input" id="extraPerson" type="number"
             min="0" step="0.01"
             placeholder="Optional"
             [(ngModel)]="extraPersonRate" />
    </div>

    <div class="field-group">
      <label class="field-label" for="mealPlan">Meal plan</label>
      <select class="field-input" id="mealPlan" [(ngModel)]="mealPlan">
        @for (mp of mealPlans; track mp.key) {
          <option [value]="mp.key">{{ mp.label }}</option>
        }
      </select>
    </div>

    <!-- Row 6: Valid from + Valid until -->
    <div class="field-group field-required">
      <label class="field-label" for="validFrom">Valid from</label>
      <input class="field-input" id="validFrom" type="date"
             [class.field-error]="validationErrors['validFrom']"
             [(ngModel)]="validFrom" />
      @if (validationErrors['validFrom']; as msg) {
        <span class="field-hint-error">{{ msg }}</span>
      }
    </div>

    <div class="field-group">
      <label class="field-label" for="validUntil">Valid until</label>
      <input class="field-input" id="validUntil" type="date"
             [class.field-error]="validationErrors['validUntil']"
             [(ngModel)]="validUntil" />
      @if (validationErrors['validUntil']; as msg) {
        <span class="field-hint-error">{{ msg }}</span>
      }
    </div>

    <!-- Row 7: Priority + Status (read-only) -->
    <div class="field-group">
      <label class="field-label" for="priority">Priority</label>
      <input class="field-input" id="priority" type="number"
             min="0" max="999"
             [(ngModel)]="priority" />
    </div>

    <div class="field-group">
      <label class="field-label">Status</label>
      <span class="badge badge-muted status-locked">Inactive</span>
      <span class="text-subtle">Activate after review</span>
    </div>

    <!-- Full-width description -->
    <div class="field-group full-width">
      <label class="field-label" for="description">Description</label>
      <textarea class="field-input" id="description" rows="2"
                placeholder="Optional description"
                [(ngModel)]="description"></textarea>
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button class="btn btn-invisible" (click)="cancel()" [disabled]="saving()">Cancel</button>
  <button class="btn btn-primary" (click)="save()" [disabled]="!canSave || saving()">
    @if (saving()) {
      <mat-spinner diameter="16"></mat-spinner>
    }
    Create rate
  </button>
</mat-dialog-actions>
