# Global configuration for all services
global:
  registry: docker.io/tartware
  imagePullPolicy: IfNotPresent
  domain: tartware.local

  # Environment
  environment: production

  # Database configuration
  database:
    host: postgres-postgresql.database.svc.cluster.local
    port: 5432
    name: tartware
    user: tartware
    # Use external secrets for password
    passwordSecret:
      name: postgres-credentials
      key: password

  # Redis configuration
  redis:
    host: redis-master.cache.svc.cluster.local
    port: 6379
    passwordSecret:
      name: redis-credentials
      key: password

  # Messaging configuration
  kafka:
    brokers: redpanda-0.redpanda.messaging.svc.cluster.local:9092,redpanda-1.redpanda.messaging.svc.cluster.local:9092,redpanda-2.redpanda.messaging.svc.cluster.local:9092,redpanda-3.redpanda.messaging.svc.cluster.local:9092,redpanda-4.redpanda.messaging.svc.cluster.local:9092,redpanda-5.redpanda.messaging.svc.cluster.local:9092,redpanda-6.redpanda.messaging.svc.cluster.local:9092

  nats:
    url: nats://nats-jetstream.messaging.svc.cluster.local:4222

  # Observability
  otel:
    enabled: true
    endpoint: opentelemetry-collector.observability.svc.cluster.local:4317

  # Service mesh
  istio:
    enabled: true

  # Resource defaults
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 1000m
      memory: 512Mi

# Individual service configurations
api-gateway:
  enabled: true
  replicaCount: 12
  image:
    repository: docker.io/tartware/api-gateway
    tag: "latest"

  service:
    type: ClusterIP
    port: 3000

  ingress:
    enabled: true
    className: nginx
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      nginx.ingress.kubernetes.io/rate-limit: "1000"
      nginx.ingress.kubernetes.io/limit-rps: "200"
    hosts:
      - host: api.tartware.local
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: api-gateway-tls
        hosts:
          - api.tartware.local

  resources:
    requests:
      cpu: 1000m
      memory: 1Gi
    limits:
      cpu: 3500m
      memory: 4Gi

  autoscaling:
    enabled: true
    minReplicas: 12
    maxReplicas: 150
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
    behavior:
      scaleUp:
        stabilizationWindowSeconds: 30
        policies:
          - type: Percent
            value: 100
            periodSeconds: 15
      scaleDown:
        stabilizationWindowSeconds: 300
        policies:
          - type: Percent
            value: 10
            periodSeconds: 60
  env:
    - name: CORE_SERVICE_URL
      value: "http://tartware-core-service:3000"
    - name: RESERVATION_COMMAND_SERVICE_URL
      value: "http://tartware-reservations-command-service:3101"
    - name: GUESTS_SERVICE_URL
      value: "http://tartware-guests-service:3000"
    - name: ROOMS_SERVICE_URL
      value: "http://tartware-rooms-service:3000"
    - name: HOUSEKEEPING_SERVICE_URL
      value: "http://tartware-housekeeping-service:3000"
    - name: BILLING_SERVICE_URL
      value: "http://tartware-billing-service:3000"
    - name: COMMAND_CENTER_SERVICE_URL
      value: "http://tartware-command-center-service:3000"
    - name: SETTINGS_SERVICE_URL
      value: "http://tartware-settings-service:3000"

core-service:
  enabled: true
  replicaCount: 8
  image:
    repository: docker.io/tartware/core-service
    tag: "latest"

  resources:
    requests:
      cpu: 750m
      memory: 1536Mi
    limits:
      cpu: 2500m
      memory: 5Gi

  autoscaling:
    enabled: true
    minReplicas: 8
    maxReplicas: 80
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 75

billing-service:
  enabled: true
  replicaCount: 5
  image:
    repository: docker.io/tartware/billing-service
    tag: "latest"

  resources:
    requests:
      cpu: 500m
      memory: 768Mi
    limits:
      cpu: 2000m
      memory: 3Gi

  autoscaling:
    enabled: true
    minReplicas: 5
    maxReplicas: 45
    targetCPUUtilizationPercentage: 75

guests-service:
  enabled: true
  replicaCount: 5
  image:
    repository: docker.io/tartware/guests-service
    tag: "latest"

  resources:
    requests:
      cpu: 500m
      memory: 768Mi
    limits:
      cpu: 2000m
      memory: 3Gi

  autoscaling:
    enabled: true
    minReplicas: 5
    maxReplicas: 45
    targetCPUUtilizationPercentage: 70

housekeeping-service:
  enabled: true
  replicaCount: 4
  image:
    repository: docker.io/tartware/housekeeping-service
    tag: "latest"

  resources:
    requests:
      cpu: 400m
      memory: 512Mi
    limits:
      cpu: 1600m
      memory: 2Gi

  autoscaling:
    enabled: true
    minReplicas: 4
    maxReplicas: 30
    targetCPUUtilizationPercentage: 75

reservations-command-service:
  enabled: true
  replicaCount: 8
  image:
    repository: docker.io/tartware/reservations-command-service
    tag: "latest"

  resources:
    requests:
      cpu: 900m
      memory: 1536Mi
    limits:
      cpu: 2500m
      memory: 5Gi

  autoscaling:
    enabled: true
    minReplicas: 8
    maxReplicas: 70
    targetCPUUtilizationPercentage: 70
  env:
    - name: AVAILABILITY_GUARD_ADDRESS
      value: "availability-guard-service:4400"
    - name: AVAILABILITY_GUARD_TIMEOUT_MS
      value: "1500"
    - name: AVAILABILITY_GUARD_ENABLED
      value: "true"
    - name: AVAILABILITY_GUARD_SHADOW_MODE
      value: "true"
    - name: AVAILABILITY_GUARD_FAIL_OPEN
      value: "true"

rooms-service:
  enabled: true
  replicaCount: 5
  image:
    repository: docker.io/tartware/rooms-service
    tag: "latest"

  resources:
    requests:
      cpu: 500m
      memory: 768Mi
    limits:
      cpu: 2000m
      memory: 3Gi

  autoscaling:
    enabled: true
    minReplicas: 5
    maxReplicas: 45
    targetCPUUtilizationPercentage: 70

settings-service:
  enabled: true
  replicaCount: 3
  image:
    repository: docker.io/tartware/settings-service
    tag: "latest"

  resources:
    requests:
      cpu: 300m
      memory: 512Mi
    limits:
      cpu: 1200m
      memory: 2Gi

  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 20
    targetCPUUtilizationPercentage: 75

command-center-service:
  enabled: true
  replicaCount: 3
  image:
    repository: docker.io/tartware/command-center-service
    tag: "latest"

  resources:
    requests:
      cpu: 400m
      memory: 512Mi
    limits:
      cpu: 1600m
      memory: 2Gi

  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 25
    targetCPUUtilizationPercentage: 75

availability-guard-service:
  enabled: false
  replicaCount: 2
  image:
    repository: docker.io/tartware/availability-guard-service
    tag: "latest"
  service:
    type: ClusterIP
    port: 3800
    targetPort: 3800
  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "3800"
    prometheus.io/path: "/metrics"
  podLabels:
    shadow-mode.tartware.io/enabled: "true"
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 512Mi
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 4
    targetCPUUtilizationPercentage: 70
  env:
    - name: NODE_ENV
      value: "production"
    - name: PORT
      value: "3800"
    - name: HOST
      value: "0.0.0.0"
    - name: LOG_LEVEL
      value: "info"
    - name: SERVICE_NAME
      value: "@tartware/availability-guard-service"
    - name: SERVICE_VERSION
      value: "0.1.0"
    - name: SHADOW_MODE
      value: "true"
    - name: AVAILABILITY_GUARD_FAIL_OPEN
      value: "true"
    - name: GRPC_PORT
      value: "4400"
    - name: RESERVATION_EVENTS_TOPIC
      value: "reservations.events"
    - name: INVENTORY_EVENTS_TOPIC
      value: "inventory.events.shadow"
    - name: INVENTORY_EVENTS_DLQ_TOPIC
      value: "inventory.events.dlq"
    - name: COMMAND_CENTER_TOPIC
      value: "commands.primary"
    - name: AVAILABILITY_GUARD_CONSUMER_GROUP
      value: "availability-guard-shadow"
    - name: LOCK_DEFAULT_TTL_SECONDS
      value: "7200"
    - name: LOCK_MAX_TTL_SECONDS
      value: "86400"
    - name: KAFKA_MAX_BATCH_BYTES
      value: "1048576"
    - name: AVAILABILITY_GUARD_NOTIFICATION_RECIPIENTS
      value: "ops@hotel.local,revenue@hotel.local"
    - name: AVAILABILITY_GUARD_NOTIFICATION_CONSUMER_ENABLED
      value: "true"
    - name: AVAILABILITY_GUARD_NOTIFICATION_CONSUMER_MAX_RETRIES
      value: "3"
    - name: AVAILABILITY_GUARD_NOTIFICATION_CONSUMER_RETRY_BACKOFF_MS
      value: "2000"
    - name: AVAILABILITY_GUARD_NOTIFICATION_DRY_RUN
      value: "true"
    - name: AVAILABILITY_GUARD_NOTIFICATION_EMAIL_ENABLED
      value: "true"
    - name: AVAILABILITY_GUARD_NOTIFICATION_EMAIL_WEBHOOK_URL
      valueFrom:
        secretKeyRef:
          name: availability-guard-notification-secrets
          key: email-webhook-url
    - name: AVAILABILITY_GUARD_NOTIFICATION_EMAIL_API_KEY
      valueFrom:
        secretKeyRef:
          name: availability-guard-notification-secrets
          key: email-api-key
    - name: AVAILABILITY_GUARD_NOTIFICATION_EMAIL_TIMEOUT_MS
      value: "7000"
    - name: AVAILABILITY_GUARD_NOTIFICATION_SMS_ENABLED
      value: "false"
    - name: AVAILABILITY_GUARD_NOTIFICATION_SMS_WEBHOOK_URL
      valueFrom:
        secretKeyRef:
          name: availability-guard-notification-secrets
          key: sms-webhook-url
    - name: AVAILABILITY_GUARD_NOTIFICATION_SMS_API_KEY
      valueFrom:
        secretKeyRef:
          name: availability-guard-notification-secrets
          key: sms-api-key
    - name: AVAILABILITY_GUARD_NOTIFICATION_SMS_TIMEOUT_MS
      value: "5000"
    - name: AVAILABILITY_GUARD_NOTIFICATION_SLACK_ENABLED
      value: "true"
    - name: AVAILABILITY_GUARD_NOTIFICATION_SLACK_WEBHOOK_URL
      valueFrom:
        secretKeyRef:
          name: availability-guard-notification-secrets
          key: slack-webhook-url
    - name: AVAILABILITY_GUARD_NOTIFICATION_SLACK_API_KEY
      valueFrom:
        secretKeyRef:
          name: availability-guard-notification-secrets
          key: slack-api-key
    - name: AVAILABILITY_GUARD_NOTIFICATION_SLACK_TIMEOUT_MS
      value: "5000"
    # Database
    - name: DB_HOST
      valueFrom:
        configMapKeyRef:
          name: database-config
          key: host
    - name: DB_PORT
      valueFrom:
        configMapKeyRef:
          name: database-config
          key: port
    - name: DB_NAME
      valueFrom:
        configMapKeyRef:
          name: database-config
          key: database
    - name: DB_USER
      valueFrom:
        secretKeyRef:
          name: database-credentials
          key: username
    - name: DB_PASSWORD
      valueFrom:
        secretKeyRef:
          name: database-credentials
          key: password
    # Kafka
    - name: KAFKA_BROKERS
      valueFrom:
        configMapKeyRef:
          name: messaging-config
          key: kafka-brokers
    # NATS
    - name: NATS_URL
      valueFrom:
        configMapKeyRef:
          name: messaging-config
          key: nats-url
    # OpenTelemetry
    - name: OTEL_EXPORTER_OTLP_ENDPOINT
      value: "http://opentelemetry-collector.observability.svc.cluster.local:4317"
    - name: OTEL_SERVICE_NAME
      value: "availability-guard-service"

roll-service:
  enabled: false
  replicaCount: 2
  image:
    repository: docker.io/tartware/roll-service
    tag: "latest"
  service:
    type: ClusterIP
    port: 3900
    targetPort: 3900
  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "3900"
    prometheus.io/path: "/metrics"
  podLabels:
    shadow-mode.tartware.io/enabled: "true"
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 512Mi
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 4
    targetCPUUtilizationPercentage: 70
  env:
    - name: NODE_ENV
      value: "production"
    - name: PORT
      value: "3900"
    - name: HOST
      value: "0.0.0.0"
    - name: LOG_LEVEL
      value: "info"
    - name: SERVICE_NAME
      value: "@tartware/roll-service"
    - name: SERVICE_VERSION
      value: "0.1.0"
    - name: SHADOW_MODE
      value: "true"
    - name: RESERVATION_EVENTS_TOPIC
      value: "reservations.events"
    - name: ROLL_SERVICE_CONSUMER_GROUP
      value: "roll-service-shadow"
    - name: KAFKA_MAX_BATCH_BYTES
      value: "1048576"
    # Database
    - name: DB_HOST
      valueFrom:
        configMapKeyRef:
          name: database-config
          key: host
    - name: DB_PORT
      valueFrom:
        configMapKeyRef:
          name: database-config
          key: port
    - name: DB_NAME
      valueFrom:
        configMapKeyRef:
          name: database-config
          key: database
    - name: DB_USER
      valueFrom:
        secretKeyRef:
          name: database-credentials
          key: username
    - name: DB_PASSWORD
      valueFrom:
        secretKeyRef:
          name: database-credentials
          key: password
    # Kafka
    - name: KAFKA_BROKERS
      valueFrom:
        configMapKeyRef:
          name: messaging-config
          key: kafka-brokers
    # NATS
    - name: NATS_URL
      valueFrom:
        configMapKeyRef:
          name: messaging-config
          key: nats-url
    # OpenTelemetry
    - name: OTEL_EXPORTER_OTLP_ENDPOINT
      value: "http://opentelemetry-collector.observability.svc.cluster.local:4317"
    - name: OTEL_SERVICE_NAME
      value: "roll-service"
